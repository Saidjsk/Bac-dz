import React, { useState } from 'react';
import AccordionItem from './AccordionItem';

const Accounting2020Correction: React.FC = () => {
    const [openAccordion, setOpenAccordion] = useState<string | null>('t1part1');

    const handleAccordionClick = (id: string) => {
        setOpenAccordion(openAccordion === id ? null : id);
    };

    const renderTable = (headers: (string|React.ReactNode)[], data: (string | number)[][], caption: string, colSpans?: Record<number, Record<number, number>>) => (
        <div className="overflow-x-auto my-4 font-sans">
            <table className="w-full min-w-max text-sm text-center text-gray-700 dark:text-gray-300 border-collapse border border-gray-300 dark:border-gray-600">
                <caption className="caption-bottom text-xs text-gray-500 dark:text-gray-400 py-1">{caption}</caption>
                <thead className="bg-gray-100 dark:bg-gray-700">
                    <tr>
                        {headers.map((header, index) => <th key={index} className="p-2 border border-gray-300 dark:border-gray-600 font-semibold">{header}</th>)}
                    </tr>
                </thead>
                <tbody>
                    {data.map((row, rowIndex) => (
                        <tr key={rowIndex} className="odd:bg-white dark:odd:bg-gray-800 even:bg-gray-50 dark:even:bg-gray-800/50">
                            {row.map((cell, cellIndex) => {
                                const colspan = colSpans?.[rowIndex]?.[cellIndex];
                                return <td key={cellIndex} className="p-2 border border-gray-300 dark:border-gray-600 font-mono" colSpan={colspan}>{cell}</td>
                            })}
                        </tr>
                    ))}
                </tbody>
            </table>
        </div>
    );

    return (
        <div className="bg-transparent" dir="rtl">
            <div className="p-4 sm:p-6">
                <header className="text-center border border-gray-200 dark:border-gray-700 rounded-lg p-4 mb-8 bg-white dark:bg-gray-800 shadow-sm text-gray-800 dark:text-gray-200">
                    <p className="font-bold text-lg">الإجابة النموذجية لموضوع اختبار مادة: التسيير المحاسبي والمالي</p>
                    <p>الشعبة: تسيير واقتصاد / بكالوريا 2020</p>
                </header>

                {/* الموضوع الأول */}
                <section className="mb-12 bg-white dark:bg-gray-800 rounded-xl shadow-md border border-gray-200 dark:border-gray-700 overflow-hidden">
                    <h2 className="text-2xl font-extrabold text-center p-5 bg-blue-50 dark:bg-blue-900/50 text-blue-700 dark:text-blue-300 border-b border-gray-200 dark:border-gray-700 tracking-wide">الموضوع الأول</h2>
                    
                    <div className="divide-y divide-gray-200 dark:divide-gray-700">
                        <AccordionItem title="الجزء الأول: أعمال نهاية السنة (06 نقاط)" isOpen={openAccordion === 't1part1'} onClick={() => handleAccordionClick('t1part1')}>
                            <ol className="list-decimal pr-6 space-y-4">
                                <li><strong>الهدف من أعمال نهاية السنة:</strong> هو إنجاز الكشوف المالية التي تعكس بصورة صادقة الوضعية المالية للمؤسسة.</li>
                                <li><strong>إنجاز مخطط الاهتلاك لمعدات النقل إلى غاية تاريخ التنازل.</strong>
                                    <p>معدل الاهتلاك: t = 100/5 = 20%</p>
                                    <p>ΣA = MA x t x n  =&gt; 500000 = MA x 0.2 x (30/12) =&gt; MA = 1000000</p>
                                    <p>قسط اهتلاك السنوي: An = 1000000 x 0.2 = 200000</p>
                                    <p>قسط اهتلاك سنة 2016: A2016 = 200000 x 6 / 12 = 100000</p>
                                    <p>VNC2018 = MA - ΣA2018 - PV = 1000000 - 500000 - 100000 = 400000</p>
                                    <p>قسط اهتلاك دورة 2019: A2019 = 400000/2.5 x 9 / 12 = 120000</p>
                                    {renderTable(
                                        ['N', 'MA', 'An', 'ΣA', 'PV', 'VNC'],
                                        [
                                            [2016, 1000000, 100000, 100000, '', 900000],
                                            [2017, 1000000, 200000, 300000, '', 700000],
                                            [2018, 1000000, 200000, 500000, 100000, 400000],
                                            [2019, 400000, 120000, 620000, '', 280000]
                                        ], 'مخطط الاهتلاك'
                                    )}
                                </li>
                                <li><strong>تسجيل قيد التنازل:</strong>
                                    <p>أ. معدات النقل:</p>
                                    {renderTable(
                                        ['مدين', 'دائن', 'البيان', 'رقم الحساب'],
                                        [
                                            [120000, '', 'اهتلاك معدات النقل (2818)', ''],
                                            ['', 120000, 'مخصصات اهتلاكات ومؤونات وخسائر القيمة للأصول الجارية (681)', ''],
                                            ['', '', '2019/10/03', ''],
                                            [250000, '', 'الحسابات الدائنة عن التنازل التثبيتات (462)', ''],
                                            [620000, '', 'اهتلاك معدات النقل (2818)', ''],
                                            [100000, '', 'خسائر قيمة عن م النقل (2918)', ''],
                                            [30000, '', 'نواقص قيمة عن خروج أصول مثبتة غير مالية (652)', ''],
                                            ['', 1000000, 'معدات النقل (218)', ''],
                                            ['', '', 'قيد التنازل', '']
                                        ], 'قيد التنازل عن معدات النقل'
                                    )}
                                    <p>ب. القيم المنقولة للتوظيف:</p>
                                     <ul className="list-disc pr-6 space-y-2">
                                        <li>تكلفة الشراء: 100 * 2000 = 200000</li>
                                        <li>سعر البيع: 100 * 1900 = 190000</li>
                                        <li>نتيجة التنازل: 190000 - 200000 = -10000 (ح/667)</li>
                                     </ul>
                                     {renderTable(
                                        ['مدين', 'دائن', 'البيان', 'رقم الحساب'],
                                        [
                                            [190000, '', 'بنوك الحسابات الجارية (512)', ''],
                                            [10000, '', 'الخسائر الصافية عن عمليات التنازل عن أصول مالية (667)', ''],
                                            ['', 200000, 'الأسهم الأخرى والسندات (503)', ''],
                                            ['', '', '2019/10/30', '']
                                        ], 'قيد التنازل عن القيم المنقولة للتوظيف'
                                     )}
                                </li>
                                <li><strong>تسجيل العمليات اللازمة في 2019/12/31:</strong>
                                    <ul className="list-disc pr-6 space-y-2">
                                        <li>تسوية الأسهم الباقية: العدد = 150 - 100 = 50 سهم. تكلفة الشراء = 50 * 2000 = 100000. سعر السوق = 50 * 2100 = 105000. فارق التقييم موجب بمبلغ 5000 (ح/765).</li>
                                        <li>مؤونة الأخطار: تشكيل مؤونة بمبلغ 150000.</li>
                                        <li>فاتورة الإنقاص: مبلغ 10000.</li>
                                        <li>حساب الزبون ليث: تحويل إلى حساب زبون مشكوك فيه. خسارة القيمة = 90000 (357000 / 1.19 * 0.3).</li>
                                     </ul>
                                </li>
                            </ol>
                        </AccordionItem>
                        <AccordionItem title="الجزء الثاني: إعداد الكشوف المالية وتحليلها (06 نقاط)" isOpen={openAccordion === 't1part2'} onClick={() => handleAccordionClick('t1part2')}>
                            <ol className="list-decimal pr-6 space-y-4">
                                <li><strong>إتمام الميزانية الوظيفية:</strong>
                                    {renderTable(
                                        ['%', 'المبالغ', 'الأصول', '%', 'المبالغ', 'الخصوم'],
                                        [
                                            [50, 1000000, 'الاستخدامات الثابتة', 60, 1200000, 'الموارد الثابتة'],
                                            ['', '', '', 50, 1000000, '- الموارد الخاصة'],
                                            ['', '', '', 10, 200000, '- الديون المالية'],
                                            [50, 1000000, 'الأصول المتداولة', 40, 800000, 'الخصوم المتداولة'],
                                            [22, 440000, '- للاستغلال', 20, 400000, '- للاستغلال'],
                                            [18, 360000, '- خارج الاستغلال', 15, 300000, '- خارج الاستغلال'],
                                            [10, 200000, '- خزينة الأصول', '05', 100000, '- خزينة الخصوم'],
                                            [100, 2000000, 'المجموع', 100, 2000000, 'المجموع']
                                        ], 'الميزانية الوظيفية'
                                    )}
                                </li>
                                <li><strong>حساب كل من:</strong>
                                    <p>أ) الخزينة الصافية (TN) = خزينة الأصول - خزينة الخصوم = 200000 - 100000 = 100000</p>
                                    <p>ب) نسبة الاستدانة المالية = (الديون المالية / الموارد الخاصة) = (200000 + 100000) / 1000000 = 0.3</p>
                                </li>
                                <li><strong>حساب المدة المتوسطة:</strong>
                                    <p>أ) مخزونات البضائع: سرعة دوران = 1350000 / 90000 = 15 دورة. المدة = 360 / 15 = 24 يوم.</p>
                                    <p>ب) الزبائن: سرعة دوران = 1560000 / 130000 = 12 دورة. المدة = 360 / 12 = 30 يوم.</p>
                                    <p>ج) الموردون: سرعة دوران = 1260000 / 210000 = 6 دورات. المدة = 360 / 6 = 60 يوم.</p>
                                </li>
                                <li><strong>التعليق على الوضعية المالية:</strong> FRNG > BFR و TN > 0. الوضعية المالية للمؤسسة جيدة. نسبة الاستدانة أقل من 0.5 مما يعني استقلالية مالية. المدة الممنوحة للزبائن أقل من مدة تسديد الموردين.</li>
                            </ol>
                        </AccordionItem>
                         <AccordionItem title="الجزء الثالث: إعداد الكشوف المالية وتحليلها (08 نقاط)" isOpen={openAccordion === 't1part3'} onClick={() => handleAccordionClick('t1part3')}>
                            <h4 className="font-bold text-lg">أولا: إنجاز حساب النتائج حسب الوظيفة</h4>
                            {renderTable(
                                ['المبالغ', 'البيان'],
                                [
                                    [7500000, 'رقم الأعمال'],
                                    [4500000, 'كلفة المبيعات'],
                                    [3000000, 'هامش الربح الإجمالي'],
                                    [400000, 'المنتوجات العملياتية الأخرى'],
                                    [200000, 'التكاليف التجارية'],
                                    [300000, 'الأعباء الإدارية'],
                                    [200000, 'الأعباء العملياتية الأخرى'],
                                    ['-', 'الاسترجاعات عن خسائر القيمة والمؤونات'],
                                    [2700000, 'النتيجة العملياتية'],
                                    [200000, 'المنتوجات المالية'],
                                    [900000, 'الأعباء المالية'],
                                    [-700000, 'النتيجة المالية'],
                                    [2000000, 'النتيجة العادية قبل الضريبة'],
                                    [500000, 'الضرائب الواجب دفعها'],
                                    ['-', 'الضرائب المؤجلة'],
                                    [1500000, 'النتيجة الصافية للأنشطة العادية'],
                                    [1500000, 'صافي نتيجة السنة المالية']
                                ], 'حساب النتائج حسب الوظيفة'
                            )}
                             <h4 className="font-bold text-lg mt-4">ثانيا: حساب قدرة التمويل الذاتي</h4>
                             <p>1- حساب قيمة إجمالي فائض الاستغلال: القيمة المضافة = 7500000 * 0.1 = 750000. أعباء المستخدمين = 750000 * 0.4 = 300000. الضرائب والرسوم = 750000 * 0.2 = 150000. إجمالي فائض الاستغلال = 750000 - 300000 - 150000 = 300000.</p>
                             <p>2- حساب قدرة التمويل الذاتي:</p>
                             {renderTable(
                                 ['المبالغ -', 'المبالغ +', 'البيان'],
                                 [
                                     ['', 300000, 'إجمالي فائض الاستغلال'],
                                     [30000, '', 'ح/652 - ح/65'],
                                     ['', 350000, 'ح/75 - ح/752'],
                                     ['', 80000, 'ح/76 - ح/765 - ح/767'],
                                     [130000, '', 'ح/66 - ح/665 - ح/667'],
                                     ['', '', 'الضرائب على النتائج'],
                                     ['', 70000, 'قدرة التمويل الذاتي']
                                 ], 'حساب قدرة التمويل الذاتي'
                             )}
                        </AccordionItem>
                    </div>
                </section>
                
                {/* الموضوع الثاني */}
                 <section className="mb-12 bg-white dark:bg-gray-800 rounded-xl shadow-md border border-gray-200 dark:border-gray-700 overflow-hidden">
                    <h2 className="text-2xl font-extrabold text-center p-5 bg-green-50 dark:bg-green-900/50 text-green-700 dark:text-green-300 border-b border-gray-200 dark:border-gray-700 tracking-wide">الموضوع الثاني</h2>
                     <div className="divide-y divide-gray-200 dark:divide-gray-700">
                        <AccordionItem title="الجزء الأول: أعمال نهاية السنة (06 نقاط)" isOpen={openAccordion === 't2part1'} onClick={() => handleAccordionClick('t2part1')}>
                             <ol className="list-decimal pr-6 space-y-4">
                                <li><strong>إنجاز حالة التقارب البنكي:</strong>
                                    {renderTable(
                                        ['دائن', 'مدين', 'البيان', 'دائن', 'مدين', 'البيان'],
                                        [
                                            ['', 340000, 'الرصيد قبل الجرد', '', 395000, 'الرصيد قبل الجرد'],
                                            ['', 30000, 'تحويل من الزبون', 20000, '', 'شيك للمورد يوسف'],
                                            [2400, '', 'خدمات مصرفية', '', '', ''],
                                            ['', 7400, 'فوائد لصالح المؤسسة', '', '', ''],
                                            [375000, '', 'رصيد بعد الجرد (مدين)', 375000, '', 'رصيد بعد الجرد (دائن)'],
                                            [377400, 377400, 'المجموع', 395000, 395000, 'المجموع']
                                        ], 'حالة التقارب البنكي'
                                    )}
                                </li>
                                <li><strong>تسجيل قيود التسوية في الدفتر اليومي:</strong> (الجداول التالية تمثل القيود)</li>
                             </ol>
                        </AccordionItem>
                         <AccordionItem title="الجزء الثاني: إعداد الكشوف المالية وتحليلها (06 نقاط)" isOpen={openAccordion === 't2part2'} onClick={() => handleAccordionClick('t2part2')}>
                              <ol className="list-decimal pr-6 space-y-4">
                                <li><strong>إنجاز حساب النتائج حسب الوظيفة:</strong> (تم تقديم الجدول الكامل في الصفحة التالية من التصحيح)</li>
                                <li><strong>إنجاز حساب النتائج حسب الطبيعة:</strong></li>
                                {renderTable(
                                    ['المبالغ', 'البيان'],
                                    [
                                        [3000000, 'المبيعات من البضائع'], [200000, 'إعانات الاستغلال'], [3200000, 'إنتاج السنة المالية'],
                                        [1000000, 'المشتريات المستهلكة'], [200000, 'خدمات خارجية والاستهلاكات الأخرى'], [1200000, 'استهلاك السنة المالية'],
                                        [2000000, 'القيمة المضافة للاستغلال'], [900000, 'أعباء المستخدمين'], [100000, 'الضرائب والرسوم'],
                                        [1000000, 'إجمالي فائض الاستغلال'], [120000, 'المنتوجات العملياتية الأخرى'], [90000, 'الأعباء العملياتية الأخرى'],
                                        [200000, 'مخصصات الاهتلاك'], [120000, 'استرجاع على خسائر القيمة'], [950000, 'النتيجة العملياتية'],
                                        [80000, 'المنتوجات المالية'], [120000, 'الأعباء المالية'], [-40000, 'النتيجة المالية'],
                                        [910000, 'النتيجة العادية قبل الضريبة'], [227500, 'الضرائب الواجب دفعها'],
                                        [3520000, 'مجموع منتوجات الأنشطة العادية'], [2837500, 'مجموع أعباء الأنشطة العادية'],
                                        [682500, 'النتيجة الصافية للأنشطة العادية'], [682500, 'صافي نتيجة السنة المالية']
                                    ], 'حساب النتائج حسب الطبيعة'
                                )}
                                 <li><strong>حساب معدل الإدماج:</strong> معدل الإدماج = القيمة المضافة / رقم الأعمال = 2000000 / 3000000 = 0.66</li>
                              </ol>
                        </AccordionItem>
                         <AccordionItem title="الجزء الثالث: أعمال نهاية السنة (08 نقاط)" isOpen={openAccordion === 't2part3'} onClick={() => handleAccordionClick('t2part3')}>
                             <ol className="list-decimal pr-6 space-y-4">
                                 <li><strong>إعداد مخطط اهتلاك السيارة النفعية:</strong> معدل خطي = 20%، معدل متناقص = 40%
                                    {renderTable(
                                        ['السنوات', 'Ma', 'An', 'ΣA', 'VNC'],
                                        [
                                            [2019, 2000000, 800000, 800000, 1200000],
                                            [2020, 1200000, 480000, 1280000, 720000],
                                            [2021, 720000, 288000, 1568000, 432000],
                                            [2022, 432000, 216000, 1784000, 216000],
                                            [2023, 216000, 216000, 2000000, 0]
                                        ], 'مخطط اهتلاك السيارة'
                                    )}
                                 </li>
                                 <li><strong>بالنسبة للشاحنة:</strong>
                                    <p>أ- حساب القيمة الأصلية: MA = 8000000 - 2000000 = 6000000</p>
                                    <p>ب- قسط الاهتلاك لدورة 2019: VNC2018 = 6000000 - 3840000 = 2160000. A2019 = 2160000 * 0.4 * 9/12 = 648000.</p>
                                    <p>ج- تسجيل قيد التنازل: نتيجة التنازل = 1200000 + (3840000 + 648000) - 6000000 = -312000 (ح/652)</p>
                                 </li>
                                 <li><strong>قيود التسوية اللازمة في 2019/12/31:</strong> (تم تقديم جداول القيود في الصفحات الأصلية)</li>
                             </ol>
                        </AccordionItem>
                     </div>
                </section>
            </div>
        </div>
    );
};

export default Accounting2020Correction;
